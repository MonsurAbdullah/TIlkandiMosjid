<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>মাসিক বেতন</title>
   <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- বাড়ির নামের তালিকা পেজে হোম বাটন -->
  <button id="back-to-index" onclick="window.location.href='index.html'">←</button>

  <header id="select-header">
    <h2>বাড়ির নাম সিলেক্ট করুন</h2> 
  </header>

  <header id="salary-header" style="display:none;">
    <h2 id="salary-header-text"></h2>
  </header>

  <div class="container">
    <div id="house-list" class="house-list"></div>
    <button id="back-to-house-list">←</button>
    <div id="salary-table"></div>
  </div>

  <script>
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSBRRLsHTtoT47EcE18nEoydsnfufRxhNIFgJeaklS6__WEKeA26i9rXdlVz7hKZbamr25C9Lu__NaN/pub?output=csv';

    const houseList = document.getElementById('house-list');
    const salaryTable = document.getElementById('salary-table');
    const backToIndexBtn = document.getElementById('back-to-index');
    const backToHouseListBtn = document.getElementById('back-to-house-list');

    let dataByHouse = {};
    let currentMonths = [];

    backToIndexBtn.style.display = 'inline-block';
    backToHouseListBtn.style.display = 'none';

    backToHouseListBtn.onclick = () => {
      showHouseList(currentMonths);
    };

    fetch(sheetURL)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.trim().split('\n').map(r => r.split(','));
        currentMonths = rows[0].slice(2);
        rows.slice(1).forEach(row => {
          const house = row[0];
          const name = row[1];
          const amounts = row.slice(2);
          if (!dataByHouse[house]) dataByHouse[house] = [];
          dataByHouse[house].push({ name, amounts });
        });

        showHouseList(currentMonths);
      });

    function showHouseList(months) {
      salaryTable.innerHTML = '';
      houseList.innerHTML = '';

      backToIndexBtn.style.display = 'inline-block';
      backToHouseListBtn.style.display = 'none';

      document.getElementById('select-header').style.display = 'block';
      document.getElementById('salary-header').style.display = 'none';

      Object.keys(dataByHouse).forEach(house => {
        const btn = document.createElement('button');
        btn.textContent = house;
        btn.className = 'house-btn';
        btn.onclick = () => showSalaryTable(house, months);
        houseList.appendChild(btn);
      });
    }

    function showSalaryTable(house, months) {
      houseList.innerHTML = '';

      backToHouseListBtn.style.display = 'inline-block';

      salaryTable.innerHTML = `
        <h3>${house}</h3>
        <table>
          <thead>
            <tr><th>নাম</th>${months.map(m => `<th>${m}</th>`).join('')}</tr>
          </thead>
          <tbody>
            ${dataByHouse[house].map(row => `
              <tr>
                <td>${row.name}</td>
                ${row.amounts.map(a => `<td class="${a.trim() === '0' ? 'unpaid' : 'paid'}">${a}</td>`).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      backToIndexBtn.style.display = 'none';

      document.getElementById('select-header').style.display = 'none';
      document.getElementById('salary-header').style.display = 'block';
      document.getElementById('salary-header-text').textContent = `মাসিক বেতনের তালিকা`;
    }
  </script>
</body>
</html>
